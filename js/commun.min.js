function changeTheme(e){var t=document.styleSheets[0].rules[1].media;t.appendMedium("original"),e=="light"?(t.mediaText.includes("light")&&t.deleteMedium("(prefers-color-scheme: light)"),t.mediaText.includes("dark")&&t.deleteMedium("(prefers-color-scheme: dark)")):(t.appendMedium("(prefers-color-scheme: light)"),t.appendMedium("(prefers-color-scheme: dark)")),e!=themeOS?localStorage.setItem("theme",e):localStorage.removeItem("theme")}var themeOS=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light",themeLocal=localStorage.getItem("theme");themeLocal&&themeOS!=themeLocal&&changeTheme(themeLocal);function affiche(e,t){$("#log").length||$('<div id="log"></div>').appendTo("body").hide(0).on("click",function(){$(this).fadeOut(800)}),$("#log").removeClass().addClass(t).html(e).append('<span class="icon-ferme"></span>').fadeIn().off("click").on("click",function(){window.clearTimeout(extinction),$(this).fadeOut(800)}),extinction=window.setTimeout(function(){$("#log").fadeOut(800)},6e3)}function reconnect(e,t){$("#fenetre,#fenetre_fond").remove();var n="valider cette action";if(e.url=="recup.php")switch(e.data.action){case"prefs":n="récupérer les préférences de cet utilisateur";break;case"docs":n="récupérer la liste des répertoires et documents disponibles";break;case"transdocs":n="actualiser la liste des documents disponibles";break;case"commentairescolles":n="récupérer les commentaires de cette colle"}else e.afficheform=Function.prototype;t?popup('<a class="icon-ok" title="Valider"></a><h3>Connexion nécessaire</h3>           <p>Votre connexion est active, mais vous devez saisir de nouveau votre mot de passe pour '+n+'.</p>           <form>           <p class="ligne"><label for="motdepasse">Mot de passe&nbsp;: </label><input type="password" name="motdepasse" id="motdepasse"></p>           </form>',!0):popup('<a class="icon-ok" title="Valider"></a><h3>Connexion nécessaire</h3>           <p>Votre connexion a été automatiquement désactivée. Vous devez vous connecter à nouveau pour '+n+'.</p>           <form>           <p class="ligne"><label for="login">Identifiant&nbsp;: </label><input type="text" name="login" id="login"></p>           <p class="ligne"><label for="motdepasse">Mot de passe&nbsp;: </label><input type="password" name="motdepasse" id="motdepasse"></p>           </form>',!0),$("#fenetre input").entreevalide($("#fenetre form")).first().focus(),$("#fenetre a.icon-ok").on("click",function(){$.ajax({url:e.url,method:"post",data:$("#fenetre form").serialize()+"&"+e.data,dataType:"json",el:e.el,afficheform:e.afficheform,fonction:e.fonction}).done(function(e){e.etat!="mdpnok"&&$("#fenetre,#fenetre_fond").remove()})}),$("#fenetre a.icon-ferme").off("click").on("click",function(){affiche("Modification non effectuée, connexion nécessaire","nok")})}function popup(e,t){$("#fenetre,#fenetre_fond").remove();var n=$('<article id="fenetre"></article>').appendTo("body").html(e).focus();t?$('<div id="fenetre_fond"></div>').appendTo("body").click(function(){$("#fenetre,#fenetre_fond").remove()}):$('<a class="icon-epingle" title="Épingler à la page"></a>').prependTo(n).on("click",function(){$("#fenetre_fond").remove(),$(this).remove(),n.removeAttr("id").prependTo($("section"))}),$('<a class="icon-ferme" title="Fermer"></a>').prependTo(n).on("click",function(){n.remove(),$("#fenetre_fond").remove()})}$(document).ajaxSend(function(e,t,n){$("#load").fadeIn(200),n.attente&&$("#load").prepend('<p class="clignote">'+n.attente+"</p>"),$("body").data("csrf-token")&&(n.data.append?n.data["csrf-token"]||n.data.append("csrf-token",$("body").data("csrf-token")):n.data.indexOf("csrf")==-1&&(n.data="csrf-token="+$("body").data("csrf-token")+"&"+n.data))}).ajaxStop(function(){$("body").data("async")||$("#load").fadeOut()}).ajaxSuccess(function(e,t,n){n.attente&&$("#load p").remove();var s=t.responseJSON;if(typeof s=="undefined")return;switch(s.etat){case"ok":$(".nepassortir").removeClass("nok nepassortir"),affiche(s.message,"ok"),s.reload?location.reload(s.reload>1):n.fonction(n.el),typeof MathJax!="undefined"&&MathJax.Hub.Queue(["Typeset",MathJax.Hub]);break;case"nok":affiche(s.message,"nok"),$("body").data("async")&&($("body").data("async",!1),$("#load").fadeOut());break;case"login":case"mdp":reconnect(n,s.etat=="mdp");break;case"recupok":n.afficheform(s)}}),$.fn.bloque=function(){return $(this).one("change",function(){$(this).addClass("nepassortir"),$(this).filter("[multiple]").prev().addClass("nepassortir"),$(this).parent("p").find("label").addClass("nepassortir")})},$.fn.entreevalide=function(e){return $(this).on("keypress",function(t){if(t.which==13)return e.find("a.icon-ok").length==1?e.find("a.icon-ok").click():e.parent().find("a.icon-ok").length==1?e.parent().find("a.icon-ok").click():e.submit(),!1})},$.fn.deplace_viewport=function(){return(this[0].getBoundingClientRect().top<0||this[0].getBoundingClientRect().bottom>window.innerHeight)&&$("html, body").animate({scrollTop:$(this).offset().top-30}),$(this)},$(function(){$("a.icon-connexion").on("click",function(){$("#menu").hasClass("visible")&&$(".icon-menu").click(),popup('<a class="icon-ok" title="Valider"></a><h3>Connexion</h3><form>  <p>Veuillez entrer votre identifiant et votre mot de passe&nbsp;:</p>  <input class="ligne" type="text" name="login" placeholder="Identifiant">  <input class="ligne" type="password" name="motdepasse" placeholder="Mot de passe">  <p class="souvenir"><label for="permconn">Se souvenir de moi</label><input type="checkbox" name="permconn" id="permconn" value="1"></p></form><p class="oubli"><a href="gestioncompte?oublimdp">Identifiant ou mot de passe oublié&nbsp;?</a></p>',!0),$.ajax({url:"recup.php",method:"post",data:{creationcompte:1},dataType:"json"}).done(function(e){e.val&&$("#fenetre").append('<p class="oubli"><a href="gestioncompte?creation">Demander une création de compte</a></p>')}),$("#fenetre input").entreevalide($("#fenetre form")).first().focus(),$("#fenetre a.icon-ok").on("click",function(){$.ajax({url:"ajax.php",method:"post",data:$("#fenetre form").serialize()+"&connexion=1",dataType:"json"})})}),$("a.icon-deconnexion").on("click",function(){$.ajax({url:"ajax.php",method:"post",data:{action:"deconnexion"},dataType:"json"})}),$(".icon-menu").on("click",function(){$("#menu").toggleClass("visible"),$("#menu").hasClass("visible")?$('<div id="menu_fond"></div>').appendTo("body").on("click",function(){$(this).remove(),$("#menu").removeClass("visible")}):$("#menu_fond").remove()}),$("a.icon-echange").on("click",function(){$.ajax({url:"recup.php",method:"post",data:{action:"compteglobal"},dataType:"json",afficheform:function(e){popup(`<h3>Changer de Cahier</h3><div></div><p>Cette liste est éditable sur l'<a href="../connexion/">interface de connexion globale</a>.</p>`,!0);var n,s=$("#fenetre"),t=e.cahiers;for(n in t)$("div",s).attr("id","cahiers").append('<a href="/'+n+'/">'+t[n]+"</a>")}})}),$("a.icon-rss").on("click",function(){popup($("#aide-rss").html(),!1)}),$(".evnmt").on("click",function(){el=$('article[data-id="'+$(this).parent().data("id")+'"]').removeClass("flash"),el.deplace_viewport().addClass("flash")}),window.addEventListener("beforeunload",function(e){$(".nepassortir").length&&(e.preventDefault(),e.returnValue="",$(".nepassortir").addClass("nok"))}),$("footer .icon-theme").on("click",function(){changeTheme((localStorage.getItem("theme")||themeOS)=="light"?"dark":"light")})})